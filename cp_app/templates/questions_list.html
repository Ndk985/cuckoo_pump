{% extends "base.html" %}
{% block title %}Список всех вопросов{% endblock %}

{% block content %}
<div class="container my-5">

  <!-- Поиск -->
  <form method="get" class="mb-4">
    <div class="input-group">
      <input type="text"
            name="search"
            value="{{ search }}"
            class="form-control bg-transparent text-body border-2 border-dark-brown rounded-2"
            placeholder="Поиск по вопросам…"
            aria-label="Поиск по вопросам">
      <button class="btn btn-outline-secondary border-2 border-dark-brown text-body"
              type="submit">Искать</button>
    </div>
  </form>

  {% if tags %}
    <div class="mb-4">
      <div class="fw-bold mb-2" style="color: var(--text-primary);">Теги для фильтрации:</div>
      <div class="tags-container">
        <a href="{{ url_for('all_questions', search=search) }}"
           class="tag-badge all-tag {% if not active_tag %}active{% endif %}">
          Все
        </a>
        {% for tag in tags %}
          <a href="{{ url_for('all_questions', tag=tag.name, search=search) }}"
             class="tag-badge {% if active_tag == tag.name %}active{% endif %}">
            {{ tag.name }}
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <h2 class="mb-4" style="color: var(--text-primary);">Список всех вопросов</h2>

  <!-- Список вопросов -->
  <ul class="list-group mb-3" style="background-color: transparent; border: none;">
    {% for question in questions %}
      <li class="list-group-item d-flex justify-content-between align-items-center"
          style="background-color: transparent; border: none;">
        <a href="{{ url_for('question_view', id=question.id) }}" class="text-decoration-none" style="color: var(--text-primary);">
          {{ question.id }}. {{ question.title|truncate(80, killwords=True, end='…') }}
        </a>
      </li>
    {% else %}
      <li class="list-group-item bg-transparent border-0" style="color: var(--text-primary);">
        Ничего не найдено.
      </li>
    {% endfor %}
  </ul>

  <!-- Пагинация -->
  {% if pagination.pages > 1 %}
  <nav aria-label="Page navigation" class="pagination-nav">
    <ul class="pagination justify-content-center">
      {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link pagination-link"
            href="{{ url_for('all_questions', page=pagination.prev_num, search=search, tag=active_tag) }}">
            <span aria-hidden="true">&laquo;</span> Назад
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link pagination-link pagination-disabled">
            <span aria-hidden="true">&laquo;</span> Назад
          </span>
        </li>
      {% endif %}

      {% for p in range(1, pagination.pages + 1) %}
        {% if p == pagination.page %}
          <li class="page-item active">
            <span class="page-link pagination-link pagination-active">{{ p }}</span>
          </li>
        {% elif p == 1 or p == pagination.pages or (p >= pagination.page - 2 and p <= pagination.page + 2) %}
          <li class="page-item">
            <a class="page-link pagination-link"
              href="{{ url_for('all_questions', page=p, search=search, tag=active_tag) }}">{{ p }}</a>
          </li>
        {% elif p == pagination.page - 3 or p == pagination.page + 3 %}
          <li class="page-item disabled">
            <span class="page-link pagination-link pagination-ellipsis">…</span>
          </li>
        {% endif %}
      {% endfor %}

      {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link pagination-link"
            href="{{ url_for('all_questions', page=pagination.next_num, search=search, tag=active_tag) }}">
            Вперед <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link pagination-link pagination-disabled">
            Вперед <span aria-hidden="true">&raquo;</span>
          </span>
        </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('main_page') }}" class="btn btn-secondary">Назад на главную</a>
  </div>
</div>
{% endblock %}