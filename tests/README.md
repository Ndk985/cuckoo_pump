# Тесты для Cuckoo Pump

## Структура тестов

```
tests/
├── __init__.py          # Пакет тестов
├── conftest.py          # Фикстуры pytest
├── test_models.py       # Тесты моделей (User, Question, Comment)
├── test_views.py         # Тесты веб-страниц и аутентификации
├── test_api.py          # Тесты REST API endpoints
├── test_quiz.py         # Тесты функциональности квиза
└── test_forms.py        # Тесты валидации форм
```

## Запуск тестов

### Запуск всех тестов
```bash
pytest
```

### Запуск из корневой директории проекта
```bash
# Из корня проекта
pytest

# С подробным выводом
pytest -v

# С выводом print statements
pytest -s

# Запуск конкретного файла
pytest tests/test_models.py

# Запуск конкретного теста
pytest tests/test_models.py::TestUser::test_create_user
```

## Категории тестов

### Модели (test_models.py)
- Создание и валидация пользователей
- Установка и проверка паролей
- Создание и управление вопросами
- Создание комментариев
- Связи между моделями

### Views (test_views.py)
- Аутентификация (логин, регистрация, выход)
- Просмотр вопросов
- CRUD операции для вопросов (требуют админ-прав)
- Добавление комментариев
- Поиск вопросов

### API (test_api.py)
- GET /api/questions/ - список вопросов
- GET /api/questions/<id>/ - получить вопрос
- POST /api/questions/ - создать вопрос
- PATCH /api/questions/<id>/ - обновить вопрос
- DELETE /api/questions/<id>/ - удалить вопрос
- GET /api/get-random-question/ - случайный вопрос

### Quiz (test_quiz.py)
- Начало квиза
- Прохождение шагов
- Раскрытие ответов
- Отметка правильных/неправильных ответов
- Завершение квиза и статистика
- Сброс квиза

### Forms (test_forms.py)
- Валидация формы вопроса
- Валидация формы логина
- Валидация формы регистрации
- Валидация формы комментария

## Фикстуры

В `conftest.py` определены следующие фикстуры:

- `client` - тестовый клиент Flask с временной БД
- `test_user` - тестовый пользователь
- `test_admin` - тестовый администратор
- `test_question` - тестовый вопрос
- `multiple_questions` - 15 тестовых вопросов
- `authenticated_client` - клиент с аутентифицированным пользователем
- `admin_client` - клиент с аутентифицированным администратором

## Настройка

Тесты используют временную SQLite базу данных, которая создаётся для каждого теста и удаляется после его завершения. CSRF защита отключена для упрощения тестирования форм.

## Требования

Все зависимости для тестирования должны быть установлены:
```bash
pip install -r requirements.txt
```

pytest уже включён в `requirements.txt`.

